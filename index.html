<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2048 with Animations</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #faf8ef;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    h1 { margin-bottom: 10px; }
    #score { font-size: 18px; margin-bottom: 20px; }
    #board {
      position: relative;
      width: 360px;
      height: 360px;
      background: #bbada0;
      border-radius: 5px;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 10px;
    }
    .cell-bg {
      background: #cdc1b4;
      border-radius: 3px;
    }
    .tile {
      position: absolute;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border-radius: 3px;
      font-size: 24px;
      transition: transform 0.15s ease-in-out;
    }
    /* Colors per value */
    .tile-2    { background: #eee4da; color: #776e65; }
    .tile-4    { background: #ede0c8; color: #776e65; }
    .tile-8    { background: #f2b179; color: #f9f6f2; }
    .tile-16   { background: #f59563; color: #f9f6f2; }
    .tile-32   { background: #f67c5f; color: #f9f6f2; }
    .tile-64   { background: #f65e3b; color: #f9f6f2; }
    .tile-128  { background: #edcf72; color: #f9f6f2; font-size: 20px; }
    .tile-256  { background: #edcc61; color: #f9f6f2; font-size: 20px; }
    .tile-512  { background: #edc850; color: #f9f6f2; font-size: 20px; }
    .tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 18px; }
    .tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 18px; }
    /* Merge pop effect */
    .merged { animation: pop 0.2s; }
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    #message { margin-top: 20px; font-size: 22px; font-weight: bold; }
    #newGame { margin-top: 10px; padding: 8px 16px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>2048</h1>
  <div id="score">Score: 0</div>
  <div id="board"></div>
  <div id="message"></div>
  <button id="newGame">New Game</button>

  <script>
    const size = 4;
    const tileSize = 80;
    const gap = 10;

    let grid, score, status;
    const board = document.getElementById("board");
    const scoreEl = document.getElementById("score");
    const msgEl = document.getElementById("message");
    const btn = document.getElementById("newGame");

    // Helpers
    const uid = () => Math.random().toString(36).slice(2);

    function initGrid() {
      grid = Array.from({ length: size }, () => Array(size).fill(null));
      score = 0;
      status = "playing";
      board.innerHTML = "";
      // Background cells
      for (let i = 0; i < size * size; i++) {
        let bg = document.createElement("div");
        bg.className = "cell-bg";
        board.appendChild(bg);
      }
      addRandomTile(); addRandomTile();
      updateUI();
    }

    function addRandomTile() {
      let empty = [];
      for (let r = 0; r < size; r++)
        for (let c = 0; c < size; c++)
          if (!grid[r][c]) empty.push({ r, c });
      if (!empty.length) return;
      let { r, c } = empty[Math.floor(Math.random() * empty.length)];
      grid[r][c] = { id: uid(), value: Math.random() < 0.9 ? 2 : 4, merged: false };
    }

    function updateUI() {
      // Remove old tiles
      document.querySelectorAll(".tile").forEach(el => el.remove());

      // Render tiles
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          let tile = grid[r][c];
          if (tile) {
            let div = document.createElement("div");
            div.className = `tile tile-${tile.value}`;
            if (tile.merged) div.classList.add("merged");
            div.textContent = tile.value;
            let x = c * (tileSize + gap);
            let y = r * (tileSize + gap);
            div.style.transform = `translate(${x}px, ${y}px)`;
            div.style.zIndex = 10;
            board.appendChild(div);
            tile.merged = false; // reset flag
          }
        }
      }
      scoreEl.textContent = "Score: " + score;
      if (status === "won") msgEl.textContent = "You win!";
      else if (status === "over") msgEl.textContent = "Game Over!";
      else msgEl.textContent = "";
    }

    // Movement logic
    function slideRow(row) {
      let arr = row.filter(v => v);
      let newRow = [];
      for (let i = 0; i < arr.length; i++) {
        if (arr[i + 1] && arr[i].value === arr[i + 1].value) {
          let merged = { id: uid(), value: arr[i].value * 2, merged: true };
          score += merged.value;
          newRow.push(merged);
          i++;
        } else {
          newRow.push({ ...arr[i] });
        }
      }
      while (newRow.length < size) newRow.push(null);
      return newRow;
    }

    function moveLeft() {
      let moved = false;
      let newGrid = [];
      for (let r = 0; r < size; r++) {
        let newRow = slideRow(grid[r]);
        if (JSON.stringify(newRow) !== JSON.stringify(grid[r])) moved = true;
        newGrid.push(newRow);
      }
      if (moved) { grid = newGrid; addRandomTile(); checkStatus(); }
    }
    function moveRight() {
      grid = grid.map(row => row.reverse());
      moveLeft();
      grid = grid.map(row => row.reverse());
    }
    function moveUp() {
      grid = transpose(grid);
      moveLeft();
      grid = transpose(grid);
    }
    function moveDown() {
      grid = transpose(grid);
      moveRight();
      grid = transpose(grid);
    }
    function transpose(m) { return m[0].map((_, c) => m.map(row => row[c])); }

    function checkStatus() {
      for (let r = 0; r < size; r++)
        for (let c = 0; c < size; c++)
          if (grid[r][c] && grid[r][c].value === 2048) status = "won";
      if (!canMove()) status = "over";
      updateUI();
    }

    function canMove() {
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (!grid[r][c]) return true;
          if (c < size - 1 && grid[r][c].value === grid[r][c + 1]?.value) return true;
          if (r < size - 1 && grid[r][c].value === grid[r + 1][c]?.value) return true;
        }
      }
      return false;
    }

    document.addEventListener("keydown", e => {
      if (status !== "playing") return;
      if (e.key === "ArrowLeft") moveLeft();
      else if (e.key === "ArrowRight") moveRight();
      else if (e.key === "ArrowUp") moveUp();
      else if (e.key === "ArrowDown") moveDown();
      updateUI();
    });

    btn.addEventListener("click", initGrid);

    initGrid();
  </script>
</body>
</html>
